webpackJsonp([1],{"4lvf":function(e,t){e.exports={basePath:"access",pages:{index:"/index.html",auth:"/access.html",register:"/register.html",reset:"/reset-password.html",signin:"/signinhub.html"}}},"7zck":function(e,t){},NHnr:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r("7+uW"),n=r("Xxa5"),a=r.n(n),i=r("exGp"),c=r.n(i),o=r("Zrlr"),u=r.n(o),l=r("wxAW"),p=r.n(l),h=r("+T3g"),f=r.n(h),v=function(){function e(t){var r=this;u()(this,e),this.selection=[];var s=t.regions;Object.keys(s).forEach(function(e){var t=s[e].zones;Object.keys(t).forEach(function(e){var s=t[e].hostings;Object.keys(s).forEach(function(e){var t=s[e],n=t.name||e;null!=t.description&&(n=n+" ("+t.description+")"),r.selection.push({value:e,text:n,description:t.description})})})})}return p()(e,[{key:"getSelection",value:function(){return this.selection}}]),e}();f.a.Service.prototype.apiEndpointForSync=function(e,t){return f.a.Service.buildAPIEndpoint(this.infoSync(),e,t)},f.a.Service.prototype.mfaChallenge=function(){var e=c()(a.a.mark(function e(t,r){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.utils.superagent.post(this.apiEndpointForSync(t)+"mfa/challenge").set("accept","json").set("Authorization",r).send({});case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),f.a.Service.prototype.mfaVerify=function(){var e=c()(a.a.mark(function e(t,r,s){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.utils.superagent.post(this.apiEndpointForSync(t)+"mfa/verify").set("accept","json").set("Authorization",r).send({code:s});case 2:return n=e.sent,e.abrupt("return",n.body.token);case 4:case"end":return e.stop()}},e,this)}));return function(t,r,s){return e.apply(this,arguments)}}(),f.a.Service.prototype.checkAppAccess=function(){var e=c()(a.a.mark(function e(t,r,s){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.utils.superagent.post(this.apiEndpointForSync(t)+"accesses/check-app").set("accept","json").set("Authorization",r).send(s);case 2:return n=e.sent,e.abrupt("return",n.body);case 4:case"end":return e.stop()}},e,this)}));return function(t,r,s){return e.apply(this,arguments)}}(),f.a.Service.prototype.createAppAccess=function(){var e=c()(a.a.mark(function e(t,r,s){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.utils.superagent.post(this.apiEndpointForSync(t)+"accesses").set("accept","json").set("Authorization",r).send(s);case 2:return n=e.sent,e.abrupt("return",n.body.access);case 4:case"end":return e.stop()}},e,this)}));return function(t,r,s){return e.apply(this,arguments)}}(),f.a.Service.prototype.deleteAppAccess=function(){var e=c()(a.a.mark(function e(t,r,s){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.utils.superagent.delete(this.apiEndpointForSync(t)+"accesses/"+s).set("accept","json").set("Authorization",r).send({id:s});case 2:return n=e.sent,e.abrupt("return",n.body.accessDeletion);case 4:case"end":return e.stop()}},e,this)}));return function(t,r,s){return e.apply(this,arguments)}}(),f.a.Service.prototype.getAvailableHostings=function(){var e=c()(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.utils.superagent.get(this.infoSync().register+"hostings").set("accept","json");case 2:return t=e.sent,e.abrupt("return",new v(t.body));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),f.a.Service.prototype.createUser=function(){var e=c()(a.a.mark(function e(t,r,s,n,i,c,o,u){var l;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.utils.superagent.post(this.infoSync().register+"user").set("accept","json").send({appid:c,username:t,password:r,email:s,hosting:n,languageCode:i||"en",invitationtoken:o||"enjoy",referer:u});case 2:return l=e.sent,e.abrupt("return",l.body);case 4:case"end":return e.stop()}},e,this)}));return function(t,r,s,n,a,i,c,o){return e.apply(this,arguments)}}(),f.a.Service.prototype.checkUsernameExistence=function(){var e=c()(a.a.mark(function e(t){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.utils.superagent.post(this.infoSync().register+t+"/server").set("accept","json").send({});case 2:return r=e.sent,e.abrupt("return",r.body.server);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),f.a.Service.prototype.getUsernameForEmail=function(){var e=c()(a.a.mark(function e(t){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.search("@")<0)){e.next=2;break}return e.abrupt("return",t);case 2:return e.next=4,f.a.utils.superagent.get(this.infoSync().register+t+"/uid").set("accept","json");case 4:return r=e.sent,e.abrupt("return",r.body.uid);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),f.a.Service.prototype.requestPasswordReset=function(){var e=c()(a.a.mark(function e(t,r){var s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.utils.superagent.post(this.apiEndpointForSync(t)+"account/request-password-reset").set("accept","json").send({appId:r,username:t});case 2:return s=e.sent,e.abrupt("return",s.status);case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),f.a.Service.prototype.changePassword=function(){var e=c()(a.a.mark(function e(t,r,s,n){var i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.utils.superagent.post(this.apiEndpointForSync(t)+"account/reset-password").set("accept","json").send({username:t,newPassword:r,appId:n,resetToken:s});case 2:return i=e.sent,e.abrupt("return",i.status);case 4:case"end":return e.stop()}},e,this)}));return function(t,r,s,n){return e.apply(this,arguments)}}();var d=function(){function e(t){if(u()(this,e),this.language=t.lang||"en",this.appId="pryv-app-web-auth-3",this.pollUrl=t.poll||t.pollUrl,this.isAccessRequest())this.pryvService=new f.a.Service;else{var r=location.hostname.split(".").slice(1).join(".")||"pryv.li",s=t.pryvServiceInfoUrl||"https://reg."+r+"/service/info";this.pryvService=new f.a.Service(s)}this.user={username:"",personalToken:"",mfaToken:""},this.checkAppResult={},this.initialized=!1}return p()(e,[{key:"init",value:function(){var e=c()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.initialized){e.next=2;break}return e.abrupt("return");case 2:if(this.initialized=!1,!this.isAccessRequest()){e.next=7;break}return e.next=6,this.loadAccessState();case 6:this.pryvService.setServiceInfo(this.accessState.serviceInfo);case 7:return e.next=9,this.pryvService.info();case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"isAccessRequest",value:function(){return this.pollUrl}},{key:"loadAccessState",value:function(){var e=c()(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.a.utils.superagent.get(this.pollUrl).set("accept","json");case 3:return t=e.sent,this.accessState=t.body,e.abrupt("return",this.accessState);case 8:throw e.prev=8,e.t0=e.catch(0),console.log(e.t0),new Error("Invalid data from Access server");case 12:case"end":return e.stop()}},e,this,[[0,8]])}));return function(){return e.apply(this,arguments)}}()},{key:"updateAccessState",value:function(){var e=c()(a.a.mark(function e(t){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.utils.superagent.post(this.pollUrl).send(t);case 2:return r=e.sent,this.accessState=t,null!=this.accessState.lang&&(this.language=this.accessState.lang),e.abrupt("return",r.status);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),m={name:"App",data:function(){return{title:"App-web-auth3",logoSrcUrl:null}},errorCaptured:function(e,t,r){alert("[Vue warn]: Unexpected error in "+r+":\n      "+e)},created:function(){var e=c()(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.ctx=new d(this.$route.query),e.next=3,this.ctx.init();case 3:return e.next=5,this.ctx.pryvService.assets();case 5:(t=e.sent).setAllDefaults(),this.logoSrcUrl=t.relativeURL(t._assets["app-web-auth3"].logo.url);case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},x={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[this._m(0),this._v(" "),t("v-app",[t("v-content",[t("v-container",[t("img",{attrs:{src:this.logoSrcUrl,height:"50px"}}),this._v(" "),t("router-view")],1)],1)],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("head",[t("title",[this._v("Auth")]),this._v(" "),t("link",{attrs:{href:"https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons",rel:"stylesheet"}})])}]};var g=r("VU/8")(m,x,!1,function(e){r("vYrD")},null,null).exports,w=r("/ocq"),y={props:{confirmation:{type:Boolean,default:!1},value:{type:String,default:""}},data:function(){return{visiblePass:!1,repass:"",rules:{required:function(e){return!!e||"Password is required."}}}},computed:{matchPassword:function(){return this.value===this.repass||"Password confirmation does not match."}}},b={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("v-text-field",{attrs:{id:"password",value:e.value,appendIcon:e.visiblePass?"lock_open":"lock",type:e.visiblePass?"text":"password",rules:[e.rules.required],label:"Password"},on:{input:function(t){return e.$emit("input",t)},"click:append":function(){return e.visiblePass=!e.visiblePass}}}),e._v(" "),e.confirmation?r("v-text-field",{attrs:{id:"passConfirmation",type:e.visiblePass?"text":"password",rules:[e.matchPassword],label:"Password confirmation"},model:{value:e.repass,callback:function(t){e.repass=t},expression:"repass"}}):e._e()],1)},staticRenderFns:[]},k=r("VU/8")(y,b,!1,null,null,null).exports,_={props:{errorMsg:{type:String,default:""},successMsg:{type:String,default:""}},computed:{alertMsg:function(){return this.successMsg.length>0?this.successMsg:this.errorMsg.length>0?this.errorMsg:""},alertType:function(){return this.successMsg.length>0?"success":"error"}}},S={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("v-divider",{staticClass:"mt-3 mb-2"}),this._v(" "),t("v-alert",{attrs:{value:this.alertMsg,type:this.alertType,transition:"scale-transition"}},[t("span",{domProps:{innerHTML:this._s(this.alertMsg)}})])],1)},staticRenderFns:[]},A=r("VU/8")(_,S,!1,null,null,null).exports,E=r("Gu7T"),F=r.n(E),P=function(){function e(t){u()(this,e),this.msg=this.parseError(t)}return p()(e,[{key:"parseError",value:function(e){if(console.error(e),"string"==typeof e)return"<b>"+e+"</b>";if(null==e||null==e.response||null==e.response.body)return"<b>"+this.unexpectedError()+"</b>";var t=e.response.body,r=t.error,s="<b>"+this.parseErrorData(r||t)+"</b>",n=r?r.body:t.errors;return s+=this.parseSubErrors(n)}},{key:"parseSubErrors",value:function(e){var t=this,r="";return null!=e&&Array.isArray(e)&&e.forEach(function(e){r+="<br/>"+t.parseErrorData(e)}),r}},{key:"parseErrorData",value:function(e){return e.detail||e.message||this.unexpectedError()}},{key:"unexpectedError",value:function(){return"Unexpected error"}}]),e}(),q=r("d7EF"),U=r.n(q);var T,R=function(e){var t=e.accessState.returnURL;if(null!=t&&"false"!==t&&t){if(t.endsWith("?")||(t+="?"),e.accessState.oaccessState)t+="state="+e.accessState.oaccessState+"&code="+e.accessState.pollKey+"&poll="+e.pollUrl;else{t+="prYvpoll="+e.pollUrl;var r=!0,s=!1,n=void 0;try{for(var a,i=Object.entries(e.accessState)[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var c=a.value,o=U()(c,2),u=o[0],l=o[1];"string"!=typeof l&&"number"!=typeof l||(t+="&prYv"+u+"="+l)}}catch(e){s=!0,n=e}finally{try{!r&&i.return&&i.return()}finally{if(s)throw n}}}location.href=t}else window.close()},I=(T=c()(a.a.mark(function e(t){var r,s,n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.checkAppResult.mismatchingAccess){e.next=6;break}return e.next=3,t.pryvService.deleteAppAccess(t.user.username,t.user.personalToken,t.checkAppResult.mismatchingAccess.id);case 3:if(e.sent.id){e.next=6;break}throw new Error("Failed removing existing access");case 6:return r={permissions:t.checkAppResult.checkedPermissions,name:t.accessState.requestingAppId,type:"app"},["deviceName","token","expireAfter","clientData"].forEach(function(e){void 0!==t.accessState[e]&&(r[e]=t.accessState[e])}),e.next=10,t.pryvService.createAppAccess(t.user.username,t.user.personalToken,r);case 10:return s=e.sent,n={status:"ACCEPTED",apiEndpoint:t.pryvService.apiEndpointForSync(t.user.username,s.token),username:t.user.username,token:s.token},e.next=14,t.updateAccessState(n);case 14:R(t);case 15:case"end":return e.stop()}},e,this)})),function(e){return T.apply(this,arguments)}),M=function(){var e=c()(a.a.mark(function e(t){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.pryvService.getUsernameForEmail(t.user.username);case 2:return r=t.user.username=e.sent,e.next=5,t.pryvService.checkUsernameExistence(r);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),C=function(){var e=c()(a.a.mark(function e(t,r,s){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M(t);case 2:return e.next=4,t.pryvService.changePassword(t.user.username,r,s,t.appId);case 4:case"end":return e.stop()}},e,this)}));return function(t,r,s){return e.apply(this,arguments)}}(),$=function(){var e=c()(a.a.mark(function e(t,r){var s,n,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s={},["requestingAppId","requestedPermissions","deviceName","token","expireAfter","clientData"].forEach(function(e){void 0!==t.accessState[e]&&(s[e]=t.accessState[e])}),e.next=4,t.pryvService.checkAppAccess(t.user.username,t.user.personalToken,s);case 4:if(null==(n=e.sent).matchingAccess){e.next=10;break}return i={status:"ACCEPTED",apiEndpoint:t.pryvService.apiEndpointForSync(t.user.username,n.matchingAccess.token),username:t.user.username,token:n.matchingAccess.token},e.next=9,t.updateAccessState(i);case 9:return e.abrupt("return",R(t));case 10:null!=n.checkedPermissions&&(t.accessState.requestedPermissions=n.checkedPermissions),t.checkAppResult=n,r();case 13:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),D=function(){var e=c()(a.a.mark(function e(t,r,s,n){var i,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=null,t.accessState&&(i=t.accessState.referer||t.accessState.requestingAppId),e.next=5,t.pryvService.createUser(t.user.username,r,s,n,t.language,t.appId,null,i);case 5:return c=e.sent,e.abrupt("return",c);case 7:case"end":return e.stop()}},e,this)}));return function(t,r,s,n){return e.apply(this,arguments)}}(),j=function(){var e=c()(a.a.mark(function e(t){var r,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.pryvService.getAvailableHostings();case 2:return r=e.sent,s=r.getSelection(),e.abrupt("return",s);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),z=function(){var e=c()(a.a.mark(function e(t,r){var s,n,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("NEED_SIGNIN"===t.accessState.status){e.next=2;break}return e.abrupt("return",R(t));case 2:return e.next=4,M(t);case 4:return s=t.user.username,e.prev=5,e.next=8,t.pryvService.login(s,r,t.appId);case 8:n=e.sent,t.user.personalToken=n.token||"",e.next=28;break;case 12:if(e.prev=12,e.t0=e.catch(5),null==e.t0.response||null==e.t0.response.body||null==e.t0.response.body.mfaToken){e.next=27;break}return i=e.t0.response.body.mfaToken,e.prev=16,e.next=19,t.pryvService.mfaChallenge(s,i);case 19:t.user.mfaToken=i||"",e.next=25;break;case 22:throw e.prev=22,e.t1=e.catch(16),new P("Failed to perform MFA challenge.");case 25:e.next=28;break;case 27:throw new P("Failed to login.");case 28:case"end":return e.stop()}},e,this,[[5,12],[16,22]])}));return function(t,r){return e.apply(this,arguments)}}(),V=function(){var e=c()(a.a.mark(function e(t){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={status:"REFUSED",reasonId:"REFUSED_BY_USER",message:"The user refused to give access to the requested permissions"},e.prev=1,e.next=4,t.updateAccessState(r);case 4:return e.prev=4,R(t),e.finish(4);case 7:case"end":return e.stop()}},e,this,[[1,,4,7]])}));return function(t){return e.apply(this,arguments)}}(),H=function(){var e=c()(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M(t);case 2:return e.next=4,t.pryvService.requestPasswordReset(t.user.username,t.appId);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),O=function(){var e=c()(a.a.mark(function e(t){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.pryvService.info();case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=c()(a.a.mark(function e(t,r){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.pryvService.mfaVerify(t.user.username,t.user.mfaToken,r);case 3:t.user.personalToken=e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),new P("MFA verification failed.");case 9:case"end":return e.stop()}},e,this,[[0,6]])}));return function(t,r){return e.apply(this,arguments)}}();function B(e,t){var r=this;return c()(a.a.mark(function s(){for(var n=arguments.length,i=Array(n),c=0;c<n;c++)i[c]=arguments[c];return a.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.apply(void 0,[e].concat(F()(i)));case 3:return r.abrupt("return",r.sent);case 6:if(r.prev=6,r.t0=r.catch(0),!(r.t0 instanceof P)){r.next=12;break}throw r.t0;case 12:throw new P(r.t0);case 13:case"end":return r.stop()}},s,r,[[0,6]])}))}var G=function(e){return{acceptAccess:B(e,I),changePassword:B(e,C),checkAccess:B(e,$),createUser:B(e,D),loadHostings:B(e,j),login:B(e,z),refuseAccess:B(e,V),resetPassword:B(e,H),getServiceInfo:B(e,O),checkUsername:B(e,M),mfaVerify:B(e,N)}},Y={components:{Password:k,Alerts:A},data:function(){return{password:"",email:"",hosting:"",hostingsSelection:[],newUser:null,submitting:!1,ctx:{},c:null,error:"",success:"",rules:{required:function(e){return!!e||"This field is required."},email:function(e){return/.+@.+/.test(e)||"E-mail must be valid."}},validForm:!1}},created:function(){var e=c()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.ctx=new d(this.$route.query),e.next=3,this.ctx.init();case 3:this.c=G(this.ctx),this.c.loadHostings().then(this.initHostings).catch(this.showError);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),methods:{submit:function(){var e=this;this.$refs.form.validate()&&(this.submitting=!0,this.c.createUser(this.password,this.email,this.hosting).then(function(t){e.newUser=t,e.success="New user successfully created: "+t.username+".",e.ctx.isAccessRequest()||(location.href=e.ctx.pryvService.apiEndpointForSync(t.username))}).catch(this.showError).finally(function(){e.submitting=!1}))},clear:function(){this.$refs.form.reset()},initHostings:function(e){this.hostingsSelection=e,this.hostingsSelection.length>0&&(this.hosting=this.hostingsSelection[0].value)},showError:function(e){this.error=e.msg}}},L={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("h1",[e._v("Register a new user")]),e._v(" "),null==e.newUser?r("v-form",{ref:"form",attrs:{id:"registerForm"},on:{submit:function(e){e.preventDefault()}},model:{value:e.validForm,callback:function(t){e.validForm=t},expression:"validForm"}},[r("v-text-field",{attrs:{id:"email",rules:[e.rules.required,e.rules.email],label:"E-mail"},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}}),e._v(" "),r("v-text-field",{attrs:{id:"username",rules:[e.rules.required],label:"Username"},model:{value:e.ctx.user.username,callback:function(t){e.$set(e.ctx.user,"username",t)},expression:"ctx.user.username"}}),e._v(" "),r("Password",{attrs:{confirmation:!0},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),e._v(" "),r("v-autocomplete",{attrs:{id:"hosting",items:e.hostingsSelection,rules:[e.rules.required],placeholder:"Choose hosting...",label:"Hosting"},model:{value:e.hosting,callback:function(t){e.hosting=t},expression:"hosting"}}),e._v(" "),r("v-btn",{attrs:{id:"submitButton",disabled:!e.validForm||e.submitting},on:{click:e.submit}},[e._v("Create")]),e._v(" "),r("v-btn",{attrs:{id:"clearButton"},on:{click:e.clear}},[e._v("Clear")]),e._v(" "),r("div",[e._v("\n      By registering you agree with our\n      "),r("a",{attrs:{target:"_blank",href:"https://pryv.com/terms-of-use/"}},[e._v("\n      terms of use")]),e._v(".\n    ")])],1):e._e(),e._v(" "),e.ctx.isAccessRequest()?r("div",[r("v-divider",{staticClass:"mt-3 mb-2"}),e._v(" "),r("router-link",{attrs:{to:{name:"Authorization"}}},[r("h3",[e._v("Go to Sign in")])])],1):e._e(),e._v(" "),r("Alerts",{attrs:{successMsg:e.success,errorMsg:e.error}})],1)},staticRenderFns:[]},W=r("VU/8")(Y,L,!1,null,null,null).exports,J={components:{Password:k,Alerts:A},props:{resetToken:{type:String,default:null}},data:function(){return{password:"",error:"",success:"",showForm:!0,submitting:!1,ctx:{},c:null,rules:{required:function(e){return!!e||"This field is required."}},validForm:!1}},computed:{pageTitle:function(){return this.resetToken?"Set a new password":"Reset password"},buttonText:function(){return this.resetToken?"Change password":"Request password reset"}},created:function(){var e=c()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.ctx=new d(this.$route.query),e.next=3,this.ctx.init();case 3:this.c=G(this.ctx);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),methods:{submit:function(){var e=this;this.$refs.form.validate()&&(this.submitting=!0,null==this.resetToken?this.c.resetPassword().then(function(){e.showForm=!1,e.success="We have sent password reset instructions to your e-mail address."}).catch(this.showError).finally(function(){e.submitting=!1}):this.c.changePassword(this.password,this.resetToken).then(function(){e.showForm=!1,e.success="Your password have been successfully changed."}).catch(this.showError).finally(function(){e.submitting=!1}))},showError:function(e){this.error=e.msg}}},K={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("h1",[e._v(e._s(e.pageTitle))]),e._v(" "),e.showForm?r("v-form",{ref:"form",on:{submit:function(e){e.preventDefault()}},model:{value:e.validForm,callback:function(t){e.validForm=t},expression:"validForm"}},[r("v-text-field",{attrs:{id:"usernameOrEmail",rules:[e.rules.required],label:"Username or email"},model:{value:e.ctx.user.username,callback:function(t){e.$set(e.ctx.user,"username",t)},expression:"ctx.user.username"}}),e._v(" "),null!=e.resetToken?r("Password",{attrs:{confirmation:!0},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}):e._e(),e._v(" "),r("v-btn",{attrs:{id:"submitButton",disabled:!e.validForm||e.submitting},on:{click:e.submit}},[e._v(e._s(e.buttonText))])],1):e._e(),e._v(" "),e.ctx.isAccessRequest()?r("div",[r("v-divider",{staticClass:"mt-3 mb-2"}),e._v(" "),r("router-link",{attrs:{to:{name:"Authorization"}}},[r("h3",[e._v("Go to Sign in")])])],1):e._e(),e._v(" "),r("Alerts",{attrs:{successMsg:e.success,errorMsg:e.error}})],1)},staticRenderFns:[]},X=r("VU/8")(J,K,!1,null,null,null).exports,Z=r("EFqf"),Q=r.n(Z),ee={props:{ctx:{type:Object,default:function(){}}},data:function(){return{dialog:!0,accessState:null,checkAppResult:null}},computed:{consentMsg:function(){if(null!=this.ctx.accessState.clientData){var e=this.ctx.accessState.clientData["app-web-auth:description"];return null!=e?Q()(e.content):""}},accessMismatch:function(){return null!=this.ctx.checkAppResult.mismatchingAccess},expire:function(){return null!=this.ctx.accessState.expireAfter}},created:function(){this.accessState=this.ctx.accessState,this.checkAppResult=this.ctx.checkAppResult},methods:{closeDialog:function(e){this.dialog=!1,this.$emit(e)}}},te={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-dialog",{attrs:{width:"600",persistent:""},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[r("v-card",[r("v-card-title",{staticClass:"headline grey lighten-2",attrs:{id:"appIdText"}},[r("span",[r("b",[e._v(e._s(e.accessState.requestingAppId))])])]),e._v(" "),r("v-card-text",{staticStyle:{"text-align":"left"}},[r("h4",[e._v("Is requesting permission:")]),e._v(" "),r("ul",e._l(e.accessState.requestedPermissions,function(t,s){return r("li",{key:s},[e._v("\n          to "+e._s(t.level.toLowerCase())+" "),r("u",[e._v(e._s("*"===t.streamId?"* (all data)":t.name||t.defaultName))])])}),0),e._v(" "),e.expire?r("span",{staticStyle:{"text-align":"left"}},[r("b",[e._v("will expire after:")]),e._v(" "+e._s(e.accessState.expireAfter)+"s\n      ")]):e._e(),e._v(" "),r("br"),e._v(" "),e.consentMsg?r("span",{domProps:{innerHTML:e._s(e.consentMsg)}}):e._e()]),e._v(" "),e.accessMismatch?r("v-alert",{staticStyle:{"text-align":"left"},attrs:{value:e.accessMismatch,type:e.alertType,transition:"scale-transition"}},[r("b",[e._v("A different access was already given to this app. Do you want to replace it?")])]):e._e(),e._v(" "),r("v-divider"),e._v(" "),r("v-card-actions",[r("v-spacer"),e._v(" "),r("v-btn",{attrs:{id:"refusePermissions"},on:{click:function(t){return e.closeDialog("refused")}}},[e._v("Reject")]),e._v(" "),r("v-btn",{attrs:{id:"acceptPermissions"},on:{click:function(t){return e.closeDialog("accepted")}}},[e._v("Accept")])],1)],1)],1)},staticRenderFns:[]},re={components:{Password:k,Permissions:r("VU/8")(ee,te,!1,null,null,null).exports,Alerts:A},data:function(){return{password:"",personalToken:"",mfaToken:"",mfaCode:"",error:"",checkedPermissions:null,checkAppResult:null,serviceInfos:{},submitting:!1,c:null,ctx:{},rules:{required:function(e){return!!e||"This field is required."},email:function(e){return/.+@.+/.test(e)||"E-mail must be valid"}},validForm:!1}},computed:{mfaActivated:{get:function(){return""!==this.ctx.user.mfaToken}}},created:function(){var e=c()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.ctx=new d(this.$route.query),e.next=3,this.ctx.init();case 3:this.c=G(this.ctx),this.c.getServiceInfo().then(this.showInfos).catch(this.showError);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),methods:{submit:function(){var e=c()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.$refs.form.validate()){e.next=16;break}return this.submitting=!0,e.prev=2,e.next=5,this.c.login(this.password);case 5:if(this.mfaActivated){e.next=8;break}return e.next=8,this.c.checkAccess(this.showPermissions);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),this.showError(e.t0);case 13:return e.prev=13,this.submitting=!1,e.finish(13);case 16:case"end":return e.stop()}},e,this,[[2,10,13,16]])}));return function(){return e.apply(this,arguments)}}(),handleMFA:function(){var e=c()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.c.mfaVerify(this.mfaCode);case 3:return e.next=5,this.c.checkAccess(this.showPermissions);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),this.showError(e.t0);case 10:return e.prev=10,this.ctx.user.mfaToken="",e.finish(10);case 13:case"end":return e.stop()}},e,this,[[0,7,10,13]])}));return function(){return e.apply(this,arguments)}}(),showPermissions:function(){this.checkAppResult=this.ctx.checkAppResult,this.checkedPermissions=this.ctx.checkedPermissions},accept:function(){this.c.acceptAccess().catch(this.showError)},refuse:function(){this.c.refuseAccess().catch(this.showError)},showError:function(e){this.error=e.msg},showInfos:function(e){this.serviceInfos=e}}},se={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("h1",[e._v("Sign in")]),e._v(" "),null!=e.ctx.checkAppResult.checkedPermissions?r("Permissions",{attrs:{ctx:e.ctx},on:{accepted:e.accept,refused:e.refuse}}):e._e(),e._v(" "),r("v-dialog",{attrs:{persistent:"",width:"600"},model:{value:e.mfaActivated,callback:function(t){e.mfaActivated=t},expression:"mfaActivated"}},[r("v-card",[r("v-card-title",{staticClass:"headline grey lighten-2"},[e._v("MFA verification")]),e._v(" "),r("v-text-field",{staticClass:"ma-3",attrs:{id:"mfaCode",rules:[e.rules.required],label:"MFA code"},model:{value:e.mfaCode,callback:function(t){e.mfaCode=t},expression:"mfaCode"}}),e._v(" "),r("v-card-actions",[r("v-spacer"),e._v(" "),r("v-btn",{on:{click:function(t){e.ctx.user.mfaToken="",e.mfaCode=""}}},[e._v("Cancel")]),e._v(" "),r("v-btn",{on:{click:function(t){return e.handleMFA()}}},[e._v("Ok")])],1)],1)],1),e._v(" "),r("v-form",{ref:"form",on:{submit:function(e){e.preventDefault()}},model:{value:e.validForm,callback:function(t){e.validForm=t},expression:"validForm"}},[r("v-text-field",{attrs:{id:"usernameOrEmail",rules:[e.rules.required],label:"Username or email"},model:{value:e.ctx.user.username,callback:function(t){e.$set(e.ctx.user,"username",t)},expression:"ctx.user.username"}}),e._v(" "),r("Password",{model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),e._v(" "),r("v-btn",{attrs:{id:"submitButton",disabled:!e.validForm||e.submitting},on:{click:e.submit}},[e._v("Sign In")]),e._v(" "),r("v-btn",{on:{click:e.refuse}},[e._v("Cancel")]),e._v(" "),e.serviceInfos.support?r("div",[e._v("\n      Feel free to reach our\n      "),r("a",{attrs:{href:e.serviceInfos.support,target:"_blank"}},[e._v("\n        helpdesk")]),e._v("\n      if you have questions.\n    ")]):e._e()],1),e._v(" "),r("v-divider",{staticClass:"mt-3 mb-2"}),e._v(" "),r("router-link",{attrs:{to:{name:"RegisterUser"}}},[r("h3",[e._v("Create an account")])]),e._v(" "),r("router-link",{attrs:{to:{name:"ResetPassword"}}},[r("h3",[e._v("Forgot password")])]),e._v(" "),r("Alerts",{attrs:{errorMsg:e.error}})],1)},staticRenderFns:[]},ne=r("VU/8")(re,se,!1,null,null,null).exports,ae={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("h1",[this._v("404 - Page not found")]),this._v("\n  The page you are looking for is like time in quantum gravity theories, it does not exist.\n")])}]},ie=r("VU/8")(null,ae,!1,null,null,null).exports,ce={components:{Alerts:A},data:function(){return{username:"",error:"",ctx:{},c:null,rules:{required:function(e){return!!e||"This field is required."}},validForm:!1,serviceInfo:{name:""}}},created:function(){var e=c()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.ctx=new d(this.$route.query),e.next=3,this.ctx.init();case 3:return this.c=G(this.ctx),e.next=6,this.ctx.pryvService.info();case 6:this.serviceInfo=e.sent;case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),methods:{submit:function(){this.$refs.form.validate()&&this.c.checkUsername().then(this.toMyPryv).catch(this.showError)},toMyPryv:function(){location.href=this.ctx.pryvService.apiEndpointForSync(this.ctx.user.username)},showError:function(e){this.error=e.msg}}},oe={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("h1",[e._v("Signin hub")]),e._v(" "),r("v-form",{ref:"form",on:{submit:function(e){e.preventDefault()}},model:{value:e.validForm,callback:function(t){e.validForm=t},expression:"validForm"}},[r("v-text-field",{attrs:{id:"usernameOrEmail",rules:[e.rules.required],label:"Username or email"},model:{value:e.ctx.user.username,callback:function(t){e.$set(e.ctx.user,"username",t)},expression:"ctx.user.username"}}),e._v(" "),r("v-btn",{attrs:{id:"submitButton",disabled:!e.validForm},on:{click:e.submit}},[e._v("Go to my homepage")])],1),e._v(" "),r("v-divider",{staticClass:"mt-3 mb-2"}),e._v(" "),r("router-link",{attrs:{to:{name:"RegisterUser"}}},[r("h3",[e._v("New to "+e._s(e.serviceInfo.name)+" ? Create an account")])]),e._v(" "),r("Alerts",{attrs:{errorMsg:e.error}})],1)},staticRenderFns:[]},ue=r("VU/8")(ce,oe,!1,null,null,null).exports,le=r("4lvf"),pe=r.n(le);s.default.use(w.a);var he=new w.a({mode:"history",base:pe.a.basePath,routes:[{path:"/",redirect:{name:"Authorization"}},{path:"/auth",name:"Authorization",component:ne,alias:pe.a.pages.auth},{path:"/register",name:"RegisterUser",component:W,alias:pe.a.pages.register},{path:"/reset",name:"ResetPassword",component:X,props:function(e){return{resetToken:e.query.resetToken}},alias:pe.a.pages.reset},{path:"/signin",name:"SigninHub",component:ue,alias:pe.a.pages.signin},{path:"*",component:ie}]});function fe(e){return!!Object.keys(e.query).length}he.beforeEach(function(e,t,r){!fe(e)&&fe(t)?r({name:e.name,query:t.query}):r()});var ve=he,de=r("3EgV"),me=r.n(de);r("7zck");s.default.use(me.a),s.default.config.productionTip=!1,new s.default({el:"#app",router:ve,components:{App:g},template:"<App/>"})},vYrD:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.fca327051a2ce3225cdd.js.map